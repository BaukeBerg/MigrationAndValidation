
!De onderlinge communicatie binnen de messtraat geschiedt m.b.v. de RS20       !
!interface kaart.De 5 machines t.w.: schaalpers                                !
!                                    kaiserpers                                !
!                                    meetmachine                               !
!                                    uitstampunit+oven                         !
!                                    brettenvuller                             !
!zijn allemaal voorzien van een RS20 interface kaart.                          !
!Centraal staat een PC20 opgesteld.                                            !
!Voor de communicatie met de 5 machines is er in de centrale PC20 voor         !
!elke machine ook een RS20 kaart aanwezig.                                     !
!Communicatie tussen de plc's onderling gaat altijd via de centrale unit       !
!
!  hoek 40_350 gewijzigd (is nu 36-356) ivm opvoeren lijn en fout opzetten     !
!          29-03-2001    C.de Vries/ H.Klaver    YP Engineering BV.

!PLC1=Meetmachine                                                              !
!PLC2=Centrale unit                                                            !
!PLC3=Kaiser pers                                                              !
!PLC4=Uitstamp unit                                                            !
!PLC5=Schaalpers                                                               !
!PLC6=Brettenvuller                                                            !


!  *********************************************************************       !
!  *                                                                   *       !
!  *  communicatie tussen CENTRALE UNIT (PLC2) en de UITSTAMPUNIT      *       !
!  *  (PLC4) via de RS20 interfacekaart.                               *       !
!  *                                                                   *       !
!  *********************************************************************       !

!                           RS20  PLC2                      RS20  PLC4         !
!                           __________                      __________         !

!begin address               192.0                            128.0            !
!                             |                                |               !
!                             |     van PLC2 naar PLC4         |               !
!                             | ---------------------------->> |               !
!                             |                                |               !
!                             |                                |               !
!eind  address               223.3                            159.3            !



!                           RS20  PLC2                      RS20  PLC4         !
!                           __________                      __________         !

!begin address               224.0                            160.0            !
!                             |                                |               !
!                             |     van PLC4 naar PLC2         |               !
!                             | <<---------------------------- |               !
!                             |                                |               !
!                             |                                |               !
!eind  address               255.3                            191.3            !


NOP
JFRF 	PROGRAMMA
NOP
NOP
NOP
LSTIO	255
END	3


!********** SUBROUTINES **********!

PROGRAMMA	AND	CONSTANT_1
JSAT	ALGEMEEN

ANDNT	TEST
JSAT	SUBTEST

AND	TEST
AND	AUTOMATISCH
JSAT	SUBENKEL

ANDNT	AUTOMATISCH
JSAT	SUBAUTO

ORNT    VERSCHROTTEN_ZONDER_STAMPEN
SET0	M121_0

LSTIO	255
END	3
NOP
NOP
NOP


!********** TRIGGER SIGNALEN **********!

ALGEMEEN	ANDNT	HOOFDMOTOR_LANGZAAM
TRIG	115.0
EQL	PULSE_NOT_41_3

ANDNT	HOOFDMOTOR_NORMAAL
TRIG	115.2
EQL	PULSE_NOT_40_3

AND	STRAAT_1_EN_2
TRIG	M118_1_TRIG_40_2
EQL	M118_2_PULSE_40_2

AND	HOOFDMOTOR_LANGZAAM
TRIG	M116_1_TRIG_41_3
EQL	PULSE_41_3

AND	HOOFDMOTOR_NORMAAL
TRIG	M116_3_TRIG_40_3
EQL	PULSE_40_3

AND	CLOCK_100_MSEC
TRIG	M117_3_TRIG_0_1_SEC_CLOCK
EQL	M118_0_PULSE_0_1_SEC_CLOCK

AND	EINDE_CYCLUS_GEBIED
TRIG	M200_2_TRIG_E_CYCLUS_GEBIED
EQL	EINDE_CYCLUS_GEBIED_PULS

ANDNT	BUFFER_40_50_GRADEN
TRIG	203.0
EQL	203.1

AND	M90_GRADEN
TRIG	204.0
EQL	PULSE_241_0_ENCODER

AND	M86_2_PULSE_RESET_STORING
TRIG	201.0
EQL	201.1



AND	SAM_KLAAR_MET_OPZET
TRIG	M101_2_TRIG_5000_PULSEN
EQL    	PULSE_SAM_KLAAR_MET_OPZET

ANDNT	PULSE_SAM_KLAAR_MET_OPZET
TRIG	M126_1_TRIG_PULSE_19_1
EQL	M126_2_PULSE_VAN_PULSE_19_1

AND	1.1
TRIG	TRIG_1SEC
EQL	M108_3_PULSE_1_SEC


          !*********** timer voor vertraagd inschakelen *******!

AND     K2_KONTAKT
AND     M118_0_PULSE_0_1_SEC_CLOCK
ANDNT   TIMER_VERTRAAGD_INSCHAKELEN
CNTD    VERTRAAGD_INSCHAKELEN_TIMER_EENHEDEN
STRB    TIMER_VERTRAAGD_INSCHAKELEN

ANDNT    K2_KONTAKT
FTCHC    05
STRD     VERTRAAGD_INSCHAKELEN_TIMER_EENHEDEN
SET0     TIMER_VERTRAAGD_INSCHAKELEN


!=============================================================================!
!=============================================================================!
!=======================		    ==================================!
!======================= ENCODER OMZETTING  ==================================!
!======================= VAN GRAY NAAR BCD  ==================================!
!=======================                    ==================================!
!=============================================================================!
!=============================================================================!


! zet bit 2 en 3 van honderdtallen codegever signalen op vaste waarde 0 !

	AND	CONSTANT_1
	SET0	B18_2_encoder_not_be_used
	SET0	B18_3_encoder_not_be_used


! Gewenste hoekstand encoder vergelijken met encoder signalen !

! In verband met storingen is er voor gekozen om de encoder signalen in     !
! GRAY_code binnen te halen.                                                !
! In onderstaande programma wordt deze GRAY_code eerst omgezet naar de      !
! BINAIRE_code.                                                             !
! Vervolgens vindt een omzetting plaats van BINAIR naar OCTAAL.             !
! Als laatste actie wordt de OCTALE_code vertaalt naar de BCD_code          !
! De beschikbare BCD_code wordt nu vergeleken met de gewenste actie_punten  !
! in de cyclus.                                                             !
! Het resultaat van de vergelijking wordt in digit "D" gezet.               !
! De bits in digit "D" hebben nu de volgende betekenis:			    !

!      D.0="1"   encoderwaarde =  gewenste waarde   (D=0001)                !
!      D.1="1"   encoderwaarde <  gewenste waarde   (D=1010)                !
!      D.2="1"   encoderwaarde >  gewenste waarde   (D=1100)                !
!      D.3="1"   encoderwaarde <> gewenste waarde   (D=1010 of D=1100)      !


!====================================!
! begin omzetting GRAY naar BCD      !
!====================================!

!************************!
!* van Gray naar Binair *!
!************************!

!B9=G9!

AND	Gray_9
EQL     Binair_9

!B8=B9*(notG8)+(notB9)*G8!

AND     Binair_9
ANDNT   Gray_8
ORNT    Binair_9
AND     Gray_8
EQL     Binair_8

!B7=B8*(notG7)+(notB8)*G7!

AND     Binair_8
ANDNT   Gray_7
ORNT    Binair_8
AND     Gray_7
EQL     Binair_7

!B6=B7*(notG6)+(notB7)*G6!

AND     Binair_7
ANDNT   Gray_6
ORNT    Binair_7
AND     Gray_6
EQL     Binair_6

!B5=B6*(notG5)+(notB6)*G5!

AND     Binair_6
ANDNT   Gray_5
ORNT    Binair_6
AND     Gray_5
EQL     Binair_5

!B4=B5*(notG4)+(notB5)*G4!

AND     Binair_5
ANDNT   Gray_4
ORNT    Binair_5
AND     Gray_4
EQL     Binair_4


!B3=B4*(notG3)+(notB4)*G3!

AND     Binair_4
ANDNT   Gray_3
ORNT    Binair_4
AND     Gray_3
EQL     Binair_3

!B2=B3*(notG2)+(notB3)*G2!

AND     Binair_3
ANDNT   Gray_2
ORNT    Binair_3
AND     Gray_2
EQL     Binair_2

!B1=B2*(notG1)+(notB2)*G1!

AND     Binair_2
ANDNT   Gray_1
ORNT    Binair_2
AND     Gray_1
EQL     Binair_1

!B0=B1*(notG0)+(notB1)*G0!

AND     Binair_1
ANDNT   Gray_0
ORNT    Binair_1
AND     Gray_0
EQL     Binair_0


!*******************!
!* Binair naar BCD *!
!*******************!

!Binair naar octaal(A2,A1,A0)!

AND	CONSTANT_1
FTCHB   Binair_3
FTCHB   Binair_4
FTCHB   Binair_5

STRD    Octaal_A1

SET0	Binair_3
SET0	Binair_4
SET0	Binair_5

SHFTR   Binair_C
SHFTR   Octaal_A2
SHFTR   Octaal_A2

!Octaal naar BCD!
!(8*A1)+A0!

FTCHC	8
MULT    Octaal_A1
STRD    BCD_output_A0
ADD	Octaal_A0

STRD    BCD_output_A0
STRD    BCD_output_A1

!8*8*A2+{(8*A1)+A0}!

FTCHC   4
FTCHC   6
MULT    Octaal_A2
STRD    BCD_output_A2

ADD     BCD_output_A0
ADD     BCD_output_A1

STRD    BCD_output_A0
STRD    BCD_output_A1
STRD    BCD_output_A2

!====================================!
! einde omzetting GRAY naar BCD      !
!====================================!





! ***************************** !
! ********** ENCODER ********** !
! ***************************** !



!=====================================================!
! HET AANTAL GRADEN WAT WORDT GEBRUIKT MOET EVEN ZIJN !
!                                           ====      !
!=====================================================!



	AND	TIMER_VERTRAAGD_INSCHAKELEN
	FTCHC	6
	FTCHC	1
	FTCHC	0
	JSAT	ENCODERSTAND
	STRB	M16_GRADEN

	FTCHC	0
	FTCHC	3
	FTCHC	0
	JSAT	ENCODERSTAND
	STRB	M30_GRADEN

        FTCHC   6
        FTCHC   3
	FTCHC	0
	JSAT	ENCODERSTAND
	STRB	M40_GRADEN

	FTCHC	0
	FTCHC	5
	FTCHC	0
	JSAT	ENCODERSTAND
        STRD    260

	FTCHC	0
	FTCHC	9
	FTCHC	0
	JSAT	ENCODERSTAND
	STRB	M90_GRADEN

      	FTCHC	0
	FTCHC	1
	FTCHC	1
	JSAT	ENCODERSTAND
	STRB	M110_GRADEN

	FTCHC	0
	FTCHC	5
	FTCHC	1
	JSAT	ENCODERSTAND
	STRB	M150_GRADEN

	FTCHC	0
	FTCHC	7
	FTCHC	1
	JSAT	ENCODERSTAND
	STRB	M170_GRADEN

	FTCHC	0
	FTCHC	9
	FTCHC	1
	JSAT	ENCODERSTAND
	STRB	M190_GRADEN

	FTCHC	0
	FTCHC	0
	FTCHC	2
	JSAT	ENCODERSTAND
	STRB	M200_GRADEN

	FTCHC	5
	FTCHC	0
	FTCHC	2
	JSAT	ENCODERSTAND
	STRB 	M205_GRADEN

	FTCHC	0
	FTCHC	1
	FTCHC	2
	JSAT	ENCODERSTAND
	STRB	M210_GRADEN

	FTCHC	0
	FTCHC	3
	FTCHC	2
	JSAT	ENCODERSTAND
	STRB	M230_GRADEN

        FTCHC   6
	FTCHC	5
	FTCHC	3
	JSAT	ENCODERSTAND
	STRB	M350_GRADEN

	FTCHC	0
	FTCHC	1
	FTCHC	3
	JSAT	ENCODERSTAND
	STRB	M310_GRADEN

        FTCHC	0
	FTCHC	3
	FTCHC	3
	JSAT	ENCODERSTAND
	STRB	M320_GRADEN

        FTCHC	4
	FTCHC	4
	FTCHC	3
	JSAT	ENCODERSTAND
	STRB	M340_GRADEN

	ANDNT	CONSTANT_1
	JFRF	Vervolg

ENCODERSTAND	COMP	BCD_output_A0
	COMP	BCD_output_A1
	COMP	BCD_output_A2

	RET

Vervolg	AND     M340_GRADEN
	SET1    EINDE_CYCLUS_GEBIED

	AND     M16_GRADEN
	SET0    EINDE_CYCLUS_GEBIED

        AND    M150_GRADEN
        SET1   BUFFER_150_310_GRADEN

        AND    M310_GRADEN
        SET0   BUFFER_150_310_GRADEN

        AND    M40_GRADEN
        SET1   BUFFER_40_50_GRADEN

        AND    260.1
        SET0   BUFFER_40_50_GRADEN

       	AND    M210_GRADEN
	SET1   BUFFER_210_230_GRADEN

	AND    M230_GRADEN
	SET0   BUFFER_210_230_GRADEN

	AND    M40_GRADEN
     	SET1   BUFFER_40_350_GRADEN

	AND    M350_GRADEN
        ORNT   TEST
	SET0   BUFFER_40_350_GRADEN

	AND	M320_GRADEN
	SET1	246.2

	AND	M16_GRADEN
	SET0	246.2


	AND	OPZETWIEL_GOED
	EQL	M160_1_OPZET_SIGNAAL_PC4

	ANDNT	HOOFDMOTOR_NORMAAL
	ORNT	HOOFDMOTOR_LANGZAAM
	EQL	M160_3_STARTPULS_UITSTAMP_UNIT

	
	
	ANDNT	M106_2_MERKER_2_STORING_OVEN
	ANDNT	M107_1_STORING_MACHINE_VOORWAARDEN
	ANDNT	M107_2_STORING_TYDENS_CYCLUS
	AND	OVEN_KAST_DAG_NACHT_STAND
	AND	SCH_REMLICHTEN
	ANDNT	AUTOMATISCH
	AND	K2_KONTAKT
	ANDNT	M108_1_MERKER_LUCHTSTORING
	ANDNT	STOP_EINDE_CYCLUS
	EQL	NIET_AUTO_NIET_STRAAT_1

	

	ANDNT	AUTOMATISCH
	EQL	OPZET_FOUT_NAAR_PC2

        AND CONSTANT_1
        FTCHD 4 !D148_ANI_MOTOR_VAN_PC2
        FTCHD 0 !D149_ANI_MOTOR_VAN_PC2
        FTCHD 0 !D150_ANI_MOTOR_VAN_PC2
        STRD D130_ANO_NAAR_MOTOR
        STRD D129_ANO_NAAR_MOTOR
        STRD D128_ANO_NAAR_MOTOR


!********** SIGNALEN NAAR PC2 **********!



!********** SIGNALEN VAN PC2 **********!

!OPZET SIGNAAL KOMT PAS ALS LUS PC4_BRANSON GROTER DAN NOMINAAL!

AND	M86_3_START_STOP_VOORWAARDEN_STRAAT
AND     M128_0_OPZET_SIGNAAL_OPZETWIEL
SET1	MERKER_OPZET_STAND_AUTO

AND	MERKER_OPZET_STAND_AUTO
AND	M87_1_LUS_PC4_BRANSON_NOMINAAL
EQL	M86_0_OPZET_SIGNAAL_OPZETWIEL

 ANDNT	M86_3_START_STOP_VOORWAARDEN_STRAAT
 ORNT    NIET_AUTO_NIET_STRAAT_1
 OR PULSE_SAM_KLAAR_MET_OPZET
 SET0    MERKER_OPZET_STAND_AUTO



!VANAF NU NIET UITSTAMPEN!

AND     M128_1_SIGNAAL_STOP_UITSTAMPEN
EQL	M86_1_SIGNAAL_STOP_UITSTAMPEN

!RESET STORING PULSE!

AND     M128_2_PULSE_RESET_STORING
EQL 	M86_2_PULSE_RESET_STORING

! START_STOP VOORWAARDEN STRAAT !

AND     M128_3_START_STOP_VOORWAARDEN_STRAAT
EQL	M86_3_START_STOP_VOORWAARDEN_STRAAT

!LUS BRANSON BUITEN GRENZEN!

AND     M129_0_LUS_PC4_BRANSON_BUITEN_GRENZEN
EQL	M87_0_LUS_PC4_BRANSON_BUITEN_GRENZEN

! RESERVE !

AND     M129_1_LUS_PC4_BRANSON_NOMINAAL
EQL	M87_1_LUS_PC4_BRANSON_NOMINAAL

AND     M129_2_LUS_PC4_BRANSON_TE_KORT
EQL	M87_2_LUS_PC4_BRANSON_TE_KORT

AND     M129_3_LUS_PC4_BRANSON_TE_LANG
EQL	M87_3_LUS_PC4_BRANSON_TE_LANG


! LUCHT STORING !

AND	K2_KONTAKT
AND	M118_0_PULSE_0_1_SEC_CLOCK
ANDNT	M107_3_OUTPUT_TIMER_LUCHTSTORING
CNTD	110
STRB	M107_3_OUTPUT_TIMER_LUCHTSTORING

ANDNT	K2_KONTAKT
FTCHC	6
STRD	110
SET0	M107_3_OUTPUT_TIMER_LUCHTSTORING

AND	M107_3_OUTPUT_TIMER_LUCHTSTORING
ANDNT	LUCHT_AANWEZIG
SET1	M108_1_MERKER_LUCHTSTORING


!***************OPZET STROOK SAM300************!
AND     PULSE_41_3
OR      PULSE_40_3
SET1    MERKER_DRUKKNOPSIGLE_LINKS_RECHTS

ANDNT   OPZETWIEL_GOED
SET0    MERKER_DRUKKNOPSIGLE_LINKS_RECHTS

ANDNT   UITSTAMPEN_NIET_VERSCHROTEN
AND     BUFFER_210_230_GRADEN
ANDNT   VERSCHROTTEN_ZONDER_STAMPEN
OR      VERSCHROTTEN_ZONDER_STAMPEN
ANDNT   UITSTAMPEN_NIET_VERSCHROTEN
EQL     MERKER_194_0_UITSTAMPEN

ORNT    AUTOMATISCH
AND     TEST
AND     M86_0_OPZET_SIGNAAL_OPZETWIEL
AND     MERKER_194_0_UITSTAMPEN
AND     SAM_KLAAR_MET_OPZET
ANDNT   MERKER_OPZET_FOUT
ANDNT   START_SCHAAR_ACTIE
ANDNT   UITSTAMPEN_NIET_VERSCHROTEN

OR      AUTOMATISCH
AND     TEST
AND     M86_0_OPZET_SIGNAAL_OPZETWIEL
AND     MERKER_194_0_UITSTAMPEN
AND     SAM_KLAAR_MET_OPZET
ANDNT   MERKER_OPZET_FOUT
ANDNT   START_SCHAAR_ACTIE
ANDNT   UITSTAMPEN_NIET_VERSCHROTEN

OR      AUTOMATISCH
AND     TEST
AND     MERKER_194_0_UITSTAMPEN
ANDNT   MERKER_OPZET_FOUT
AND     MERKER_DRUKKNOPSIGLE_LINKS_RECHTS

SET1    INPUT1_SAM_START_210_GRADEN_CODEGEVER
SET1    UITSTAMPEN_NIET_VERSCHROTEN


ANDNT   SAM_KLAAR_MET_OPZET
SET0    INPUT1_SAM_START_210_GRADEN_CODEGEVER


!*************CONTROLE OPZET*****************!

ANDNT      STROOK2_IN_POSITIE
ANDNT      STROOK_IN_POSITIE
! AND        OPZETWIEL_GOED
EQL        STROOK_OPZETWIEL_GOED

AND        STROOK_OPZETWIEL_GOED
TRIG       M245_2_TRIG_OOGJES
EQL        PULSE_OOGJES

AND        PULSE_OOGJES
CNTU       EENH_COUNTER_STROOKOPZET


AND        CONSTANT_1
FTCHC      5
STRD       COMPARE_STROOK_OPZET

AND        SAM_KLAAR_MET_OPZET
OR         TIMER_OUTPUT_CYCLUSTIJD_CYCLUSMOTOR
FTCHD      COMPARE_STROOK_OPZET
COMP       EENH_COUNTER_STROOKOPZET
STRB       STROOK_OPZET_TELLER

ANDNT      STROOK_OPZET_TELLER
AND        EINDE_CYCLUS_GEBIED
ANDNT      VERSCHROTTEN_ZONDER_STAMPEN
ORNT       STROOK_OPZET_TELLER
AND        SAM_KLAAR_MET_OPZET
AND        VERSCHROTTEN_ZONDER_STAMPEN
SET1       STROOK_OPZET_FOUT


AND        INPUT1_SAM_START_210_GRADEN_CODEGEVER
SET1       BUFFER_CONTROLE_OPZET

AND        BUFFER_CONTROLE_OPZET
ANDNT      TIMER_CONTROLE_OPZET
AND        M118_0_PULSE_0_1_SEC_CLOCK
CNTD       EENHEDEN_COUNTER_OPZET
CNTD       TIENTALLEN_COUNTER_OPZET
STRB       TIMER_CONTROLE_OPZET

AND        PULSE_SAM_KLAAR_MET_OPZET
SET0       BUFFER_CONTROLE_OPZET



AND        INPUT1_SAM_START_210_GRADEN_CODEGEVER
FTCHC      0
STRD       EENH_COUNTER_STROOKOPZET

ANDNT      BUFFER_CONTROLE_OPZET
FTCHC      2
FTCHC      1
STRD       EENHEDEN_COUNTER_OPZET
STRD       TIENTALLEN_COUNTER_OPZET



AND      BUFFER_40_50_GRADEN
SET0     STROOK_OPZETWIEL_GOED
AND      INPUT1_SAM_START_210_GRADEN_CODEGEVER
SET1     STROOK_OPZETWIEL_GOED
NOP


! ********** STOP VOORWAARDEN ********** !

! STOP EINDE CYCLUS ALS OPZETWIEL NIET IN JUISTE POSITIE !
! STORING TYDENS DE CYCLUS!
! GEEN ALIVE              !
ANDNT   000.1
AND	EINDE_CYCLUS_GEBIED_PULS
OR	M204_2_PLAAT_NIET_IN_BOVENSTE_POSITIE
OR	SCHAAR_CYCLUS_TE_LANG
ORNT    M207_0_STROOK_GOED
OR  ST_GEENALIVE
SET1    M107_2_STORING_TYDENS_CYCLUS

! STORING T.G.V. NIET JUISTE STARTVOORWAARDEN MACHINE !

ORNT AUTOMATISCH
ANDNT TEST
OR	AUTOMATISCH
ANDNT TEST
ORNT	OVEN_KAST_DAG_NACHT_STAND
ORNT	SCH_REMLICHTEN
OR	M108_1_MERKER_LUCHTSTORING
EQL	M107_1_STORING_MACHINE_VOORWAARDEN

ANDNT M107_1_STORING_MACHINE_VOORWAARDEN       
FTCHD      0
COMP       STATUSSTORING2_PC2
EQL       lc_iRUNNINGCONDITIONS


!***************** ALIVE MET CENTRALE BESTURING ***************************

AND     I_ALIVE_PC2
TRIG    TRIG_ALIVE
FTCHC   0
FTCHC   2
STRD    D0_ALIVETIJD
STRD    D1_ALIVETIJD
SET0    T_GEENALIVE

AND     M118_0_PULSE_0_1_SEC_CLOCK   !pulse clock CONSTANT_1 s
ANDNT   T_GEENALIVE
CNTD    D0_ALIVETIJD
CNTD    D1_ALIVETIJD
STRB    T_GEENALIVE

AND     T_GEENALIVE
SET1    ST_GEENALIVE

! Begin wijziging D.de Jong PRS12881 19-2-03 13:34
! ANDNT   HOOFDMOTOR_NORMAAL   !storing reset puls
AND M160_3_STARTPULS_UITSTAMP_UNIT
! Einde wijziging D.de Jong PRS12881 19-2-03 13:34
ANDNT   T_GEENALIVE
SET0    ST_GEENALIVE

AND     I_ALIVE_PC2
EQL 	LC_iALIVE


!***************** EINDE ALIVE MET CENTRALE BESTURING *********************




!********** STOP EINDE CYCLUS **********!

OR      M203_2_MES_PLAAT_NIET_IN_ACHTERSTE_STAND
OR 	M107_2_STORING_TYDENS_CYCLUS
AND	EINDE_CYCLUS_GEBIED_PULS
OR	M106_2_MERKER_2_STORING_OVEN
ANDNT	AUTOMATISCH
AND	EINDE_CYCLUS_GEBIED_PULS
OR	TIMER_OUTPUT_CYCLUSTIJD_CYCLUSMOTOR
OR	M114_2_MERKER_KOELWATER_OVEN
ORNT    M207_0_STROOK_GOED
OR      TIMER_CONTROLE_OPZET
AND     VERSCHROTTEN_ZONDER_STAMPEN
OR      TIMER_CONTROLE_OPZET
AND     EINDE_CYCLUS_GEBIED_PULS
ANDNT   VERSCHROTTEN_ZONDER_STAMPEN
SET1	STOP_EINDE_CYCLUS

AND     HOOFDMOTOR_NORMAAL
SET0    STROOK_OPZET_FOUT



!VOORWAARDEN RODE STATUSLAMP (STORINGS) UITSTAMPUNIT!

OR      M106_2_MERKER_2_STORING_OVEN
OR      M107_2_STORING_TYDENS_CYCLUS
OR	M107_1_STORING_MACHINE_VOORWAARDEN
OR      TIMER_OUTPUT_CYCLUSTIJD_CYCLUSMOTOR
OR      STOP_EINDE_CYCLUS
EQL     M114_3_MERKER_STORINGS_LAMP

!********** INDICATIE UITSTAMPUNIT **********!

!LED STROOK!

AND     NIET_AUTO_NIET_STRAAT_1
EQL	LED_START_VOORWAARDEN

AND     M87_2_LUS_PC4_BRANSON_TE_KORT
EQL     LED_LUS_TE_KORT

AND     M87_3_LUS_PC4_BRANSON_TE_LANG
EQL     LED_LUS_TE_LANG

AND     EINDE_CYCLUS_GEBIED
EQL     LED_EINDE_CYCLUS

AND     M207_0_STROOK_GOED
EQL     LED_OPZET_GOED

ANDNT   M207_0_STROOK_GOED
SET1 	LED_OPZET_FOUT
!EQL     LED_OPZET_FOUT

! LED LUCHTSTORING !

AND	M108_1_MERKER_LUCHTSTORING
EQL	LED_LUCHTSTORING




!RODE STATUSLAMP (STORING) UITSTAMPUNIT!

!LAMP MAG NIET BRANDEN ALS NOODRELAIS UIT IS   !
!DIT I.V.M. HET CONTINUE AANBLIJVEN VAN DE OVEN!

AND	M87_1_LUS_PC4_BRANSON_NOMINAAL
SET0	MERKER_SNEL_KNIPPEREN_STORINGS_LAMP
SET0	MERKER_LANGZAAM_KNIPPEREN_STORINGS_LAMP

AND	M87_2_LUS_PC4_BRANSON_TE_KORT
SET1	MERKER_LANGZAAM_KNIPPEREN_STORINGS_LAMP

AND	M87_3_LUS_PC4_BRANSON_TE_LANG
SET1	MERKER_SNEL_KNIPPEREN_STORINGS_LAMP

!   ***********************************************
!   ***   AANSTURING STATUSLAMPEN ORANJE/ROOD   ***
!   ***********************************************


! Timer 44 *    geen aan-/afvoer knipperen oranje lamp

	AND	221.0	!start timer  44
        AND     1.1     !pulse clock 1 s
	ANDNT	221.1	!ready timer  44
	CNTD	1087	!unit timer 44
	CNTD	1086	!ten timer  44
	STRB	221.1	!ready timer  44

	ANDNT	221.0	!start timer  44
	FTCHC	0
	FTCHC	3
	STRD	1086	!ten timer  44
	STRD	1087	!unit timer 44
	SET0	221.1	!ready timer  44

        ANDNT   M128_3_START_STOP_VOORWAARDEN_STRAAT   !start opzet vanuit wasmb
        ANDNT   114.3   !merker storing
        EQL     221.0   !start timer 44

	AND	114.3	!;MERKER STORING
	AND	010.2	!;RELAISKONTAKT K2
        EQL     21.3    !;RODE STATUSLAMP STORING

	ANDNT	021.3	!;ALGEHELE STORINGSLAMP 5V UITSTAMPEN
	ANDNT	041.1	!;AUTOMATISCH
        ANDNT   221.1   ! ready timer 44
        OR      221.1   !ready timer 44
        AND     001.1   !;CLOCK 1  SEC.
        EQL     020.1   !;GELE WAARSCHUWINGSLAMP



!******************** HARDINGS OVEN ********************!

AND    KET_WIEL
AND    CLOCK_100_MSEC
TRIG   215.0
CNTD   216
CNTD   217
STRB   215.1

AND    215.1
SET0   MERKER_TIMER_KET_WIEL

ORNT    KET_WIEL
FTCHC    9
FTCHC    4
STRD   216
STRD   217
SET1   MERKER_TIMER_KET_WIEL

ANDNT   KET_WIEL
AND    CLOCK_100_MSEC
TRIG   215.2
CNTD   218
CNTD   219
STRB   215.3

AND    215.3
SET0   MERKER_TIMER_KETTING_WIEL

OR      KET_WIEL
FTCHC    9
FTCHC    4
STRD   218
STRD   219
SET1   MERKER_TIMER_KETTING_WIEL

!BEDIENING HOOFD RELAIS OVEN KAST!
AND	KOELWATER_OVEN_OP_TEMPERATUUR
EQL	OVEN_OPTO_KM10

!STORINGLAMP OVENKAST!

AND	M106_2_MERKER_2_STORING_OVEN
AND	OVEN_KAST_DAG_NACHT_STAND
OR	M114_2_MERKER_KOELWATER_OVEN
EQL	STORINGSLAMP_OVEN



!STORING OVEN!

ORNT	OVEN_ZONE_1a
ORNT	OVEN_ZONE_2a
ORNT	OVEN_ZONE_3a
ORNT	OVEN_ZONE_1b
ORNT	OVEN_ZONE_2b
ORNT	OVEN_ZONE_3b
ORNT	I14_3_BANDSNELHEID_TE_HOOG
ORNT	I15_0_BANDSNELHEID_TE_LAAG
ORNT   MERKER_TIMER_KET_WIEL
ORNT   MERKER_TIMER_KETTING_WIEL
EQL    M106_1_MERKER_1_STORING_OVEN

AND   M106_1_MERKER_1_STORING_OVEN                           !Merker voor storing resetten wanneer oven wordt overbrugd.
ANDNT OVERBRUGGEN_OVEN
EQL   M106_1_MERKER_1_STORING_OVEN

AND	M106_1_MERKER_1_STORING_OVEN
AND	OVEN_KAST_DAG_NACHT_STAND
ANDNT OVERBRUGGEN_OVEN
SET1  M106_2_MERKER_2_STORING_OVEN

!STORING T.G.V. KOELWATER TEMP OVEN BUITEN BEREIK!

ANDNT	KOELWATER_OVEN_OP_TEMPERATUUR
ANDNT OVERBRUGGEN_OVEN
SET1	M114_2_MERKER_KOELWATER_OVEN

!ZWAAILAMP T.G.V. STORINGOVENZONE!

ORNT  OVEN_ZONE_1a
ORNT  OVEN_ZONE_2a
ORNT  OVEN_ZONE_3a
ORNT  OVEN_ZONE_1b
ORNT  OVEN_ZONE_2b
ORNT  OVEN_ZONE_3b
EQL   M103_3_STORING_OVENZONE

AND   M103_3_STORING_OVENZONE
AND   OVEN_KAST_DAG_NACHT_STAND
ANDNT OVERBRUGGEN_OVEN
EQL   ZWAAILAMP_OVENZONE

!********** FUNCTIES UITSTAMPUNIT **********!

!CYCLUS MOTOR!

!rem cyclusmotor!
NOP
AND		START_BUFFER
ANDNT	M121_0                 !NOT verschrotten zonder stampen
ORNT  SCH_REMLICHTEN
AND   DR_REMLICHTEN
OR		START_BUFFER
AND		M121_0                 !verschrotten zonder stampen
ANDNT	TEST
ANDNT	EINDE_CYCLUS_GEBIED
EQL		REM_ELDUTRONIC

!dt na rem cyclusmotor!

AND     REM_ELDUTRONIC
AND     M118_0_PULSE_0_1_SEC_CLOCK
ANDNT   DT_NA_REM_ELDUTRONIC
CNTD    120
STRB    DT_NA_REM_ELDUTRONIC

ANDNT   REM_ELDUTRONIC
FTCHC   2
STRD    120
SET0    DT_NA_REM_ELDUTRONIC

!cyclusmotor aan!

AND     DT_NA_REM_ELDUTRONIC
AND     SCH_REMLICHTEN
ANDNT	  M121_0                  !NOT verschrotten zonder stampen
OR			DT_NA_REM_ELDUTRONIC
AND	    M121_0                  !verschrotten zonder stampen
ANDNT		TEST
ANDNT		EINDE_CYCLUS_GEBIED
EQL     RELAIS_A

AND     RELAIS_A
EQL     ELDUTRONIC_ENABLE       ! rvd prs 13343

         !CENTREERPENNEN en MAGNEETKOPPEN!

AND     AHTERSTE_STAND_SCHUIFPLAAT_30_220_GRADEN
SET1    KLEP_MAGNEET_KOPJES
SET1    KLEP_CENTREERPENNEN

AND     VOORSTE_STAND_SCHUIFPLAAT_310_330_GRADEN
SET0    KLEP_MAGNEET_KOPJES

AND     BUFFER_150_310_GRADEN
SET0    KLEP_CENTREERPENNEN



!BANDMOTOR!


AND     RELAIS_A
OR	CONSTANT_1
EQL     BANDMOTOR_AFVOER_SCHROT



!SCHAAR BEDIENING!

AND     TEST
AND	PULSE_SAM_KLAAR_MET_OPZET
SET1 	START_SCHAAR_ACTIE
SET0	MERKER_MET_ZONDER_STAMPUNIT

AND	START_SCHAAR_ACTIE
AND	M118_0_PULSE_0_1_SEC_CLOCK
ANDNT	TIMER_SCHAAR
CNTD	212
STRB	TIMER_SCHAAR

ANDNT	START_SCHAAR_ACTIE
FTCHC	01
STRD	212
SET0	MARKER_SCHAARACTIE

AND	TIMER_SCHAAR
ANDNT	MARKER_SCHAARACTIE
AND	SCHAAR_OPEN
SET0    M206_3
SET0	SCHROOTSCHAAR_OPEN
SET1	SCHROOTSCHAAR_DICHT

AND	TIMER_SCHAAR
AND	SCHAAR_DICHT
ANDNT	MARKER_SCHAARACTIE
SET0	SCHROOTSCHAAR_DICHT
SET1	SCHROOTSCHAAR_OPEN
SET1	MARKER_SCHAARACTIE

AND	TIMER_SCHAAR
AND	MARKER_SCHAARACTIE
AND	SCHAAR_OPEN
SET0	MARKER_SCHAARACTIE
SET0	TIMER_SCHAAR
SET1	MERKER_MET_ZONDER_STAMPUNIT
SET0	START_SCHAAR_ACTIE
SET0    UITSTAMPEN_NIET_VERSCHROTEN


!TIMER SCHAAR CYCLUS BEWAKING!

AND	TIMER_SCHAAR
AND	M118_0_PULSE_0_1_SEC_CLOCK
ANDNT	SCHAAR_CYCLUS_TE_LANG
CNTD	210
CNTD	211
STRB	SCHAAR_CYCLUS_TE_LANG

ANDNT	TIMER_SCHAAR
FTCHC	0
FTCHC	1
STRD	210
STRD	211
SET0	SCHAAR_CYCLUS_TE_LANG

ANDNT	SCHAAR_OPEN
SET1	SCHAAR_NIET_OPEN_VOOR_OPZET


!OPZET WIEL BEVEILIGING EN CONTROLE!

!BOVEN PLAAT ACHTER CONTROLE!

AND	BUFFER_40_50_GRADEN
ANDNT	AHTERSTE_STAND_SCHUIFPLAAT_30_220_GRADEN
SET1	M203_2_MES_PLAAT_NIET_IN_ACHTERSTE_STAND

!PENNEN BOVENSTE STAND!

AND	PULSE_241_0_ENCODER
ANDNT	PENNEN_IN_BOVENSTE_POSITIE
SET1	M204_2_PLAAT_NIET_IN_BOVENSTE_POSITIE

!CONTROLE OPZET WIEL IN POSITIE EN STROOK GOED!


ANDNT   STROOK_IN_POSITIE
ANDNT   STROOK2_IN_POSITIE
! AND     OPZETWIEL_GOED
OR      BUFFER_40_350_GRADEN
OR      VERSCHROTTEN_ZONDER_STAMPEN
EQL	M207_0_STROOK_GOED

ANDNT M207_0_STROOK_GOED
SET1 M195_0_mem_strook_Fout

ANDNT M207_0_STROOK_GOED
ANDNT OPZETWIEL_GOED
SET1 M195_1_OpzetwielFout

!OPZETTEN ZONDER CYCLUS MOTOR!

ANDNT    STRAAT_1_EN_2
TRIG    121.1
SET1    M106_0_MERKER_STRAAT1_STRAAT2

AND	VERSCHROTTEN_ZONDER_STAMPEN
AND	EINDE_CYCLUS_GEBIED_PULS
AND	START_BUFFER
OR	VERSCHROTTEN_ZONDER_STAMPEN
ANDNT	START_BUFFER
SET1	M121_0

AND     M118_2_PULSE_40_2
SET0    M106_0_MERKER_STRAAT1_STRAAT2

AND     M106_0_MERKER_STRAAT1_STRAAT2
AND	EINDE_CYCLUS_GEBIED
OR       M86_1_SIGNAAL_STOP_UITSTAMPEN
AND     EINDE_CYCLUS_GEBIED
SET1    VERSCHROTTEN_ZONDER_STAMPEN

ANDNT   M106_0_MERKER_STRAAT1_STRAAT2
ANDNT    M86_1_SIGNAAL_STOP_UITSTAMPEN
AND     PULSE_SAM_KLAAR_MET_OPZET
SET0    VERSCHROTTEN_ZONDER_STAMPEN

AND	AUTOMATISCH
TRIG	124.0
EQL	M124_1_PULSE_41_1

AND	STRAAT_1
TRIG	124.2
EQL	M124_3_PULSE_STRAAT1

AND	TEST
ANDNT	AUTOMATISCH
ORNT	TEST
AND	AUTOMATISCH
TRIG	125.1
EQL	M125_2_PULSE_STAND_TEST_OF_AUTO

AND	M124_1_PULSE_41_1
OR	M124_3_PULSE_STRAAT1
OR	M125_2_PULSE_STAND_TEST_OF_AUTO
OR	M118_2_PULSE_40_2
EQL	M125_3_RESET_PULSE_VAN_KEUZESCHAKELAAR

ANDNT	CONSTANT_1
SET0	START_BUFFER


!*********** Error STATUS NAAR PC2************!
! STATUSSTORING2_PC2 wordt gebruikt voor status naar lusbesturing !

! AUTO !
ANDNT   AUTOMATISCH
AND     TEST
EQL     LC_iAUTOMATIC

! Reset errors
!AND	CONSTANT_1
AND M125_3_RESET_PULSE_VAN_KEUZESCHAKELAAR
FTCHC   0
FTCHC   0
STRD    STATUSSTORING1_PC2
STRD    STATUSSTORING2_PC2

AND     M106_2_MERKER_2_STORING_OVEN
FTCHC   0
FTCHC   10
STRD    STATUSSTORING1_PC2
STRD    STATUSSTORING2_PC2

ANDNT   LUCHT_AANWEZIG
FTCHC   0
FTCHC   11
STRD    STATUSSTORING1_PC2
STRD    STATUSSTORING2_PC2

ANDNT   M207_0_STROOK_GOED
FTCHC   0
FTCHC   12
STRD    STATUSSTORING1_PC2
STRD    STATUSSTORING2_PC2

AND     SCHAAR_CYCLUS_TE_LANG
FTCHC   0
FTCHC   13
STRD    STATUSSTORING1_PC2
STRD    STATUSSTORING2_PC2

AND     M204_2_PLAAT_NIET_IN_BOVENSTE_POSITIE
FTCHC   0
FTCHC   14
STRD    STATUSSTORING1_PC2
STRD    STATUSSTORING2_PC2

AND     TIMER_OUTPUT_CYCLUSTIJD_CYCLUSMOTOR
FTCHC   0
FTCHC   15
STRD    STATUSSTORING1_PC2
STRD    STATUSSTORING2_PC2




!***************CYCLUS TYD BEWAKING CYCLUSMOTOR********!
AND	EINDE_CYCLUS_GEBIED
FTCHC	9
STRD	CYCLUSMOTOR_CYCLUS_BEWAKING

ANDNT	EINDE_CYCLUS_GEBIED
ANDNT	TIMER_OUTPUT_CYCLUSTIJD_CYCLUSMOTOR
AND	M108_3_PULSE_1_SEC
CNTD	CYCLUSMOTOR_CYCLUS_BEWAKING
STRB	TIMER_OUTPUT_CYCLUSTIJD_CYCLUSMOTOR


!SNEL_LANGZAAM LOPEN CYCLUS MOTOR!

AND     M128_0_OPZET_SIGNAAL_OPZETWIEL
EQL	SNEL_LANGZAAM_CYCLUS_MOTOR

RET


SUBTEST	ANDNT	HOOFDMOTOR_LANGZAAM
	ORNT	HOOFDMOTOR_NORMAAL
	EQL	RELAIS_D_TORNEN

	AND	CONSTANT_1
	EQLNT	RELAIS_B_AUTOMATISCH

	ANDNT	TEST
	AND	M87_1_LUS_PC4_BRANSON_NOMINAAL
	AND	PULSE_NOT_41_3
	ORNT	TEST
	AND	M87_1_LUS_PC4_BRANSON_NOMINAAL
	AND	PULSE_NOT_40_3
	SET1	START_BUFFER

AND	PULSE_41_3
OR	PULSE_40_3
ORNT	STRAAT_1_EN_2
AND	PULSE_SAM_KLAAR_MET_OPZET
OR	EINDE_CYCLUS_GEBIED_PULS
OR	M87_0_LUS_PC4_BRANSON_BUITEN_GRENZEN
AND	EINDE_CYCLUS_GEBIED_PULS
OR	M121_0
ORNT    M207_0_STROOK_GOED
SET0	START_BUFFER

!STORING MERKERS!

!AND	CONSTANT_1
AND M125_3_RESET_PULSE_VAN_KEUZESCHAKELAAR
SET0	M203_2_MES_PLAAT_NIET_IN_ACHTERSTE_STAND
SET0	M204_2_PLAAT_NIET_IN_BOVENSTE_POSITIE
SET0	STOP_EINDE_CYCLUS
SET0	SCHAAR_NIET_OPEN_VOOR_OPZET
SET0	SCHAAR_CYCLUS_TE_LANG
SET0	M202_0_MERKER_OPZETWIEL_IN_POS
SET0	M107_1_STORING_MACHINE_VOORWAARDEN
SET0    M107_2_STORING_TYDENS_CYCLUS
SET0	M106_2_MERKER_2_STORING_OVEN
SET0	TIMER_OUTPUT_CYCLUSTIJD_CYCLUSMOTOR
SET0	M114_2_MERKER_KOELWATER_OVEN
SET0	M108_1_MERKER_LUCHTSTORING
SET0	M103_3_STORING_OVENZONE
SET0    TIMER_CONTROLE_OPZET
SET0    UITSTAMPEN_NIET_VERSCHROTEN
SET0 	LED_OPZET_FOUT
SET0    M195_0_mem_strook_Fout
SET0	M195_1_OpzetwielFout

!*************SINGLE STEP LINKS RECHTS OM****!

AND     DRUKNOP_SINGLE_STEP
AND     DRUKNOP_SINGLE_STEP
EQL     INPUT2_LINKS_RECHTS_KEUZESCHAKELAAR


AND     DRUKNOP_SINGLE_STEP
AND     KEUZESCHAKELAAR_SAM300_LINKS_RECHTS
EQL     INPUT3_DRUKKNOP_SINGLE_STEP



RET


!enkelslag cyclusmotor!

SUBENKEL	AND	CONSTANT_1
EQL	RELAIS_D_TORNEN
EQLNT	RELAIS_B_AUTOMATISCH

  !startbuffer!

AND     PULSE_NOT_40_3
AND	M87_1_LUS_PC4_BRANSON_NOMINAAL
AND     EINDE_CYCLUS_GEBIED
AND	SAM_KLAAR_MET_OPZET
AND     STRAAT_1_EN_2
AND     M207_0_STROOK_GOED
OR	PULSE_NOT_41_3
AND	M87_1_LUS_PC4_BRANSON_NOMINAAL
AND	EINDE_CYCLUS_GEBIED
AND	SAM_KLAAR_MET_OPZET
AND     STRAAT_1_EN_2
AND     M207_0_STROOK_GOED
SET1    START_BUFFER

ANDNT	STRAAT_1_EN_2
AND	PULSE_SAM_KLAAR_MET_OPZET
OR	EINDE_CYCLUS_GEBIED_PULS
OR	STOP_EINDE_CYCLUS
OR	M87_0_LUS_PC4_BRANSON_BUITEN_GRENZEN
AND     EINDE_CYCLUS_GEBIED_PULS
OR	M121_0
SET0    START_BUFFER




RET



 !automatisch!

SUBAUTO	AND     CONSTANT_1
EQLNT   RELAIS_D_TORNEN
EQL	RELAIS_B_AUTOMATISCH

AND	M86_0_OPZET_SIGNAAL_OPZETWIEL
AND	M86_3_START_STOP_VOORWAARDEN_STRAAT
ANDNT   VERSCHROTTEN_ZONDER_STAMPEN
SET1	START_BUFFER

ANDNT	M86_0_OPZET_SIGNAAL_OPZETWIEL
AND     EINDE_CYCLUS_GEBIED_PULS
ORNT	M86_0_OPZET_SIGNAAL_OPZETWIEL
AND	VERSCHROTTEN_ZONDER_STAMPEN
AND	M126_2_PULSE_VAN_PULSE_19_1
OR	STOP_EINDE_CYCLUS
ORNT	M86_3_START_STOP_VOORWAARDEN_STRAAT
AND	EINDE_CYCLUS_GEBIED_PULS
OR	M87_0_LUS_PC4_BRANSON_BUITEN_GRENZEN
AND	EINDE_CYCLUS_GEBIED_PULS
OR	M107_1_STORING_MACHINE_VOORWAARDEN
AND	EINDE_CYCLUS_GEBIED_PULS
SET0    START_BUFFER



RET

